<div *ngIf="contentData">
  <form [formGroup]="filterLogsForm">
    <div cdsGrid
         [useCssGrid]="true"
         [condensed]="false"
         [narrow]="true"
         [fullWidth]="true">
          <div cdsCol
               [columnNumbers]="{sm: 2, md: 2, lg: 3}"
               class="form-item">
            <cds-text-label i18n>Priority</cds-text-label>
            <cds-combo-box *ngIf="priorityItems && priorityItems.length"
                            
                            i18n-label
                            placeholder="Select priority"
                            i18n-placeholder
                            id="logs-priority"
                            [appendInline]="false"
                            [items]="priorityItems"
                            itemValueKey="value"
                            (selected)="onPrioritySelection($event)"
                            (search)="onKeywordChange($event)"
                            formControlName="priority"
                            (clear)="onPriorityClear()">
                <cds-dropdown-list></cds-dropdown-list>
            </cds-combo-box>
          </div>

          <div cdsCol
               [columnNumbers]="{sm: 2, md: 3, lg: 3}">
            <!-- <cds-text-label i18n>Date -->
                <cds-date-picker
                    placeholder="YYYY-MM-DD"
                    label="Date"
                    i18n-placeholder
                    dateFormat="Y-m-d"
                    formControlName="selectedDate"
                    (valueChange)="onDateChange($event)"
                    cdsTheme="theme">
                </cds-date-picker>
            <!-- </cds-text-label> -->
          </div>

          <div cdsCol
               [columnNumbers]="{sm: 1, md: 1, lg: 2}"
               offsetLg="1"
               style="margin-left: 1rem;"
               class="form-item">
            <!-- <cds-text-label i18n>Start Time -->
                <cds-timepicker
                    formControlName="startTime"
                    label="Start Time"
                    (valueChange)="onStartTimeChange($event)"
                    pattern="(1[012]|[0-9]):[0-5][0-9]">
                    <cds-timepicker-select
                    formControlName="startAmPm"
                    (valueChange)="onStartAmPmChange($event)">
                    <option value="AM">AM</option>
                    <option value="PM">PM</option>
                    </cds-timepicker-select>
                </cds-timepicker>
            <!-- </cds-text-label> -->
          </div>

          <div cdsCol
               [columnNumbers]="{sm: 1, md: 1, lg: 2}"
               class="form-item">
            <!-- <cds-text-label i18n>End Time -->
                <cds-timepicker
                    formControlName="endTime"
                    label="End Time"
                    (valueChange)="onEndTimeChange($event)"
                    pattern="(1[012]|[0-9]):[0-5][0-9]">
                    <cds-timepicker-select
                    formControlName="endAmPm"
                    (valueChange)="onEndAmPmChange($event)">
                    <option value="AM">AM</option>
                    <option value="PM">PM</option>
                    </cds-timepicker-select>
                </cds-timepicker>
            <!-- </cds-text-label> -->
          </div>   
    </div>
    
    <div cdsStack="horizontal"
         gap="5">
      <span class="form-item">
        <!-- <cds-text-label i18n>Priority </cds-text-label>-->
        <cds-combo-box *ngIf="priorityItems && priorityItems.length"
                        label="Priority"
                        i18n-label
                        placeholder="Select priority"
                        i18n-placeholder
                        id="logs-priority"
                        [appendInline]="false"
                        [items]="priorityItems"
                        itemValueKey="value"
                        (selected)="onPrioritySelection($event)"
                        (search)="onKeywordChange($event)"
                        formControlName="priority"
                        (clear)="onPriorityClear()">
          <cds-dropdown-list></cds-dropdown-list>
        </cds-combo-box></span>

        <span class="form-item">
        <cds-date-picker placeholder="YYYY-MM-DD"
                         label="Date"
                         i18n-placeholder
                         dateFormat="Y-m-d"
                         formControlName="selectedDate"
                         (valueChange)="onDateChange($event)"
                         cdsTheme="theme">
        </cds-date-picker>
      </span>

        <span class="form-item">
          <cds-timepicker formControlName="startTime"
                          label="Start Time"
                          (valueChange)="onStartTimeChange($event)"
                          pattern="(1[012]|[0-9]):[0-5][0-9]">
            <cds-timepicker-select formControlName="startAmPm"
                                  (valueChange)="onStartAmPmChange($event)">
              <option value="AM">AM</option>
              <option value="PM">PM</option>
            </cds-timepicker-select>
          </cds-timepicker>
        </span>

        <span class="form-item">
          <cds-timepicker formControlName="endTime"
                          label="End Time"
                          (valueChange)="onEndTimeChange($event)"
                          pattern="(1[012]|[0-9]):[0-5][0-9]">
            <cds-timepicker-select formControlName="endAmPm"
                                  (valueChange)="onEndAmPmChange($event)">
              <option value="AM">AM</option>
              <option value="PM">PM</option>
            </cds-timepicker-select>
          </cds-timepicker>
        </span>
    </div>
  </form>

  <cds-tabs [type]="'contained'"
            [followFocus]="true"
            [isNavigation]="true"
            [cacheActive]="true">
    <cds-tab heading="Cluster Logs"
             i18n-heading
             [active]="true"
             [tabContent]="culsterLogs">
    </cds-tab>
    <cds-tab heading="Audit Logs"
             i18n-heading
            
             [tabContent]="auditLogs">
    </cds-tab>
    <cds-tab heading="Daemon Logs"
             i18n-heading
           
             [tabContent]="daemonLogs">
    </cds-tab>
  </cds-tabs>

</div>

<ng-template #noEntriesTpl>
  <span i18n>No log entries found. Please try to select different filter options.</span>
  <span>&nbsp;</span>
  <a href="#"
     (click)="resetFilter()"
     i18n>Reset filter.</a>
</ng-template>

<ng-template #daemonLogsTpl>
  <cd-alert-panel type="info"
                  title="Loki/Alloy service not running"
                  i18n-title>
  <ng-container i18n>Please start the loki and alloy services to see these logs.</ng-container>
  </cd-alert-panel>
</ng-template>


<ng-template #culsterLogs>
  <div class="logs-container">
         <!-- [ngClass]="{'overflow-auto': scrollable}"> -->

  
    <!-- <div class="btn-group"
         role="group"
         *ngIf="clog.length && showClusterLogs">
      <cd-download-button [objectItem]="clog"
                          [textItem]="clogText"
                          fileName="cluster_log"
                          *ngIf="showDownloadCopyButton">
      </cd-download-button>
      <cd-copy-2-clipboard-button
                [source]="clogText"
                [byId]="false"
                *ngIf="showDownloadCopyButton">
      </cd-copy-2-clipboard-button>
    </div> -->
    <!-- <div cdsStack="vertical" gap="1"
           *ngIf="clog"> -->
      <cds-code-snippet
        display="multi"
        [autoAlign]="true"
        [copyButtonDescription]="true"
        [expanded]="codeSnippetExpanded">
      @for(line of clog; track line) { 
        <div>
          <span cdsStack="horizontal" 
                gap="2"
                *ngIf="clog">
          <p><span class="timestamp">{{ line.stamp | cdDate }}</span></p>
          <p><span class="priority {{ line.priority | logPriority }}">{{ line.priority }}</span></p>
          <p><span class="message" 
                [innerHTML]="line.message | searchHighlight: search"></span></p>
          </span>
        </div>
      } 
    
    <!--  </div> -->
    <ng-container *ngIf="clog.length !== 0 else noEntriesTpl"></ng-container>
   </cds-code-snippet>
  </div>  
</ng-template>

<ng-template #auditLogs>
  <div class="card bg-light mb-3"
       *ngIf="audit_log && showAuditLogs">
    <div class="btn-group"
         role="group"
         *ngIf="audit_log.length">
      <cd-download-button [objectItem]="audit_log"
                          [textItem]="auditLogText"
                          fileName="audit_log"
                          *ngIf="showDownloadCopyButton">
      </cd-download-button>
      <cd-copy-2-clipboard-button
                [source]="auditLogText"
                [byId]="false"
                *ngIf="showDownloadCopyButton">
      </cd-copy-2-clipboard-button>
    </div>
    <div class="card-body">
      <p *ngFor="let line of audit_log">
        <span class="timestamp">{{ line.stamp | cdDate }}</span>
        <span class="priority {{ line.priority | logPriority }}">{{ line.priority }}</span>
        <span class="message"
              [innerHTML]="line.message | searchHighlight: search"></span>
      </p>

      <ng-container *ngIf="audit_log.length !== 0 else noEntriesTpl"></ng-container>
    </div>
  </div>
</ng-template>

<ng-template #daemonLogs> 
    <div *ngIf="alloyServiceStatus$ | async as alloyServiceStatus; else daemonLogsTpl">
      <cd-grafana i18n-title
                  title="Daemon logs"
                  [grafanaPath]="'explore?'"
                  [type]="'logs'"
                  uid="CrAHE0iZz"
                  grafanaStyle="three">
      </cd-grafana>
    </div>
</ng-template>
