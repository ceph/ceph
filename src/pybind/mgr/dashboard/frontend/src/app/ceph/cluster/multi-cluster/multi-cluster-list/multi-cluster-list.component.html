<ng-template #emptyCluster>
  <ng-container class="container h-75"
                *ngIf="managedByConfig$ | async as managedByConfig">
    <div class="row h-100 justify-content-center align-items-center">
      <div class="blank-page">
        <svg [cdsIcon]="icons.wrench"
             [size]="icons.size20"
             class="cds-info-color cds-icon-wrench"></svg>
      <div class="mt-4 text-center">
        <h4 class="mt-3">This cluster is already managed by cluster -
          <a target="_blank"
             [href]="managedByConfig['MANAGED_BY_CLUSTERS'][0]['url']">
            {{ managedByConfig['MANAGED_BY_CLUSTERS'][0]['fsid'] }}
            <svg [cdsIcon]="icons.launch"
                 [size]="icons.size16"
                 class="cds-info-color"></svg>
          </a>
        </h4>
      </div>
      </div>
    </div>
  </ng-container>
</ng-template>

<ng-container *ngIf="managedByConfig$ | async as managedByConfig">
  <div *ngIf="managedByConfig['MANAGED_BY_CLUSTERS'].length === 0; else emptyCluster">
    <nav ngbNav
         #nav="ngbNav"
         class="nav-tabs">
      <ng-container ngbNavItem>
        <a ngbNavLink
           i18n>Clusters List</a>
        <ng-template ngbNavContent>
          <cd-table #table
                    [data]="data"
                    [columns]="columns"
                    columnMode="flex"
                    selectionType="single"
                    (fetchData)="refresh()"
                    [hasDetails]="true"
                    (setExpandedRow)="setExpandedRow($event)"
                    [maxLimit]="25"
                    (updateSelection)="updateSelection($event)">
            <cd-table-actions [permission]="permissions.user"
                              [selection]="selection"
                              class="table-actions"
                              id="cluster-actions"
                              [tableActions]="tableActions">
            </cd-table-actions>
            <cd-multi-cluster-details *cdTableDetail
                                      [permissions]="permissions"
                                      [selection]="expandedRow">
            </cd-multi-cluster-details>
          </cd-table>
        </ng-template>
      </ng-container>
    </nav>
    <div [ngbNavOutlet]="nav"></div>
  </div>
</ng-container>

<ng-template #urlTpl
             let-row="data.row">
  <a target="_blank"
     [href]="row.url">
      {{ row?.url?.endsWith('/') ? row?.url?.slice(0, -1) : row.url }}
    <svg [cdsIcon]="icons.launch"
         [size]="icons.size16"
         class="cds-info-color"></svg>
  </a>
</ng-template>

<ng-template #durationTpl
             let-column="data.column"
             let-value="data.value"
             let-row="data.row">
  <span *ngIf="row.remainingTimeWithoutSeconds > 0 && row.cluster_alias !== 'local-cluster'">
    <svg  i18n-title
          *ngIf="row.remainingDays < 8"
          [cdsIcon]="icons.warning"
          title="Cluster's token is about to expire"
          [size]="icons.size16"
          [class.cds-danger-color]="row.remainingDays < 2"
          [class.cds-warning-color]="row.remainingDays < 8"
          class="cds-warning-color"></svg>
      {{row.remainingDays}}
    <span title="{{ row.expiryDate }}">{{ row.remainingTimeWithoutSeconds / 1000 | duration }}</span>
  </span>
  <span *ngIf="row.remainingTimeWithoutSeconds <= 0 && row.remainingDays <=0 && row.cluster_alias !== 'local-cluster'">
    <svg i18n-title
         [cdsIcon]="icons.danger"
         title="Cluster's token has expired"
         [size]="icons.size16"
         class="cds-danger-color"></svg>
    <span class="text-danger">Token expired</span>
  </span>
  <span *ngIf="row.cluster_alias === 'local-cluster'">N/A</span>
</ng-template>
