<cd-rgw-multisite-tabs></cd-rgw-multisite-tabs>
<div>
  <cd-alert-panel *ngIf="!rgwModuleStatus"
                  type="info"
                  spacingClass="mb-3"
                  class="d-flex align-items-center"
                  i18n>In order to access the import/export feature, the rgw module must be enabled
    <button class="btn btn-light mx-2"
            type="button"
            (click)="enableRgwModule()">Enable</button>
  </cd-alert-panel>
  <cd-alert-panel   *ngIf="restartGatewayMessage"
                    type="warning"
                    spacingClass="mb-3"
                    i18n>Please restart all Ceph Object Gateway instances in all zones to ensure consistent multisite configuration updates.
    <a class="text-decoration-underline"
       routerLink="/services">
       Cluster->Services</a>
  </cd-alert-panel>
  <cd-table-actions class="btn-group mb-4 me-2"
                    [permission]="permission"
                    [selection]="selection"
                    [tableActions]="multisiteReplicationActions">
  </cd-table-actions>
  <cd-table-actions *ngIf="showMigrateAndReplicationActions"
                    class="btn-group mb-4 me-2 secondary"
                    [permission]="permission"
                    [btnColor]="'light'"
                    [selection]="selection"
                    [tableActions]="migrateTableAction">
  </cd-table-actions>
  <cd-table-actions *ngIf="!showMigrateAndReplicationActions"
                    class="btn-group mb-4 me-2"
                    [permission]="permission"
                    [selection]="selection"
                    [tableActions]="createTableActions"
                    [primaryDropDown]="true">
  </cd-table-actions>
  <cd-table-actions class="btn-group mb-4 me-2"
                    [permission]="permission"
                    [btnColor]="'light'"
                    [selection]="selection"
                    [tableActions]="importAction">
  </cd-table-actions>
  <cd-table-actions class="btn-group mb-4 me-2"
                    [permission]="permission"
                    [btnColor]="'light'"
                    [selection]="selection"
                    [tableActions]="exportAction">
  </cd-table-actions>
</div>
<div class="card">
  <div class="card-header"
       i18n>Topology Viewer
  </div>
  <div class="row">
    <div class="col-sm-6 col-lg-6 tree-container">
      <i *ngIf="loadingIndicator"
         [ngClass]="[icons.large, icons.spinner, icons.spin]"></i>
      <cds-tree-view #tree
                     [isMultiSelect]="false"
                     (select)="onNodeSelected($event)">
        <ng-template #nodeTemplateRef
                     let-node="node"
                     let-depth="depth">
          <cds-tree-node [node]="node"
                         [depth]="depth">
            <ng-container *ngIf="node?.children && node?.children?.length">
              <ng-container *ngFor="let child of node.children; let i = index;">
                <ng-container *ngTemplateOutlet="nodeTemplateRef; context: { node: child, depth: depth + 1 };">
                </ng-container>
              </ng-container>
            </ng-container>
          </cds-tree-node>
        </ng-template>
        <ng-template #treeNodeTemplate
                     let-node>
          <div class="w-100 d-flex justify-content-between align-items-center pe-1">
            <div>
              <span *ngIf="node?.data?.name"
                    class="me-3">
                <span *ngIf="(node?.data?.show_warning)">
                  <i  class="text-danger"
                      i18n-title
                      [title]="node?.data?.warning_message"
                      [ngClass]="icons.danger"></i>
                </span>
                <i [ngClass]="node?.data?.icon"></i>
                {{ node?.data?.name }}
              </span>
              <span class="badge badge-success me-2"
                    *ngIf="node?.data?.is_default">
                  default
              </span>
              <span class="badge badge-warning me-2"
                    *ngIf="node?.data?.is_master"> master </span>
              <span class="badge badge-warning me-2"
                    *ngIf="node?.data?.secondary_zone">
                secondary-zone
              </span>
            </div>
            <div class="btn-group align-inline-btns"
                 [ngStyle]="{'visibility': activeNodeId === node?.data?.id ? 'visible' : 'hidden'}"
                 role="group">
              <div [title]="editTitle"
                   i18n-title>
                <button type="button"
                        class="btn btn-light dropdown-toggle-split ms-1"
                        (click)="openModal(node, true)"
                        [disabled]="getDisable() || node?.data?.secondary_zone">
                  <i [ngClass]="[icons.edit]"></i>
                </button>
              </div>
              <ng-container *ngIf="isDeleteDisabled(node) as nodeDeleteData">
                <div [title]="nodeDeleteData.deleteTitle"
                     i18n-title>
                  <button type="button"
                          class="btn btn-light ms-1"
                          [disabled]="nodeDeleteData.isDisabled || node?.data?.secondary_zone"
                          (click)="delete(node)">
                    <i [ngClass]="[icons.destroy]"></i>
                  </button>
                </div>
              </ng-container>
            </div>
          </div>
        </ng-template>
        <ng-container *ngFor="let node of nodes">
          <ng-container *ngTemplateOutlet="nodeTemplateRef; context: { node: node, depth: 0 };">
          </ng-container>
        </ng-container>
      </cds-tree-view>
    </div>
    <div class="col-sm-6 col-lg-6 metadata"
         *ngIf="metadata">
      <legend>{{ metadataTitle }}</legend>
      <div>
        <cd-table-key-value [data]="metadata">
        </cd-table-key-value>
      </div>
    </div>
  </div>
</div>

<router-outlet name="modal"></router-outlet>
