<ng-template #matcherTpl
             let-matcher="matcher"
             let-index="index">
  <div cdsRow
       class="form-item form-item-append ">
    <div cdsCol
         [columnNumbers]="{ lg: 6, md: 6 }">
      <cds-text-label>
        Matcher Name
        <input cdsText
               type="text"
               class="input-field"
               [value]="matcher.name"
               disabled
               readonly>
      </cds-text-label>
    </div>
    <div cdsCol
         [columnNumbers]="{ lg: 2, md: 2 }">
      <span  *ngIf="matcher.isRegex">=~</span>
      <span *ngIf="!matcher.isRegex">=</span>
    </div>
    <div cdsCol
         [columnNumbers]="{ lg: 6, md: 6 }">
      <cds-text-label>
        Matcher Value
        <input cdsText
               type="text"
               class="input-field"
               [value]="matcher.value">
      </cds-text-label>
    </div>
  <!-- Edit Button -->
    <div cdsCol
         [columnNumbers]="{ lg: 1, md: 1 }"
         class="item-action-btn spacing">
      <cds-icon-button kind="primary"
                       size="sm"
                       id="matcher-edit-{{ index }}"
                       (click)="showMatcherModal(index)"
                       i18n-title
                       title="Edit matcher">
        <svg cdsIcon="edit"
             size="32"
             class="cds--btn__icon"></svg>
      </cds-icon-button>
    </div>
    <div cdsCol
         [columnNumbers]="{ lg: 1, md: 1 }"
         class="item-action-btn spacing">
      <cds-icon-button kind="danger"
                       size="sm"
                       id="matcher-delete-{{ index }}"
                       (click)="deleteMatcher(index)">
        <svg cdsIcon="trash-can"
             size="32"
             class="cds--btn__icon"></svg>
      </cds-icon-button>
    </div>
  </div>
</ng-template>
<div cdsCol
     [columnNumbers]="{ md: 4 }">
  <form name="form"
        #formDir="ngForm"
        [formGroup]="silenceForm"
        novalidate>
  <div class="form-header">
    {{ action | titlecase }} {{ resource | upperFirst }}
    <cd-help-text>
      <span i18n
            *ngIf="edit">
      Configure the push endpoint parameters to send notifications. On successful creation, you'll receive the destination's unique Amazon Resource Name
      </span>
    </cd-help-text>
  </div>
  <div class="form-item form-item-append"
       cdsRow>
    <!--Creator -->
    <div cdsCol>
      <cds-text-label labelInputID="CreatedBy"
                      i18n
                      i18n-helperText
                      cdRequiredField="CreatedBy"
                      [invalid]="silenceForm.controls.createdBy.invalid && silenceForm.controls.createdBy.dirty"
                      [invalidText]="createdByError">Created By
      <input cdsText
             type="text"
             id="createdBy"
             formControlName="createdBy"
             [invalid]="silenceForm.controls.createdBy.invalid && silenceForm.controls.createdBy.dirty"/>
      </cds-text-label>
      <ng-template #createdByError>
        <span class="invalid-feedback"
              *ngIf="silenceForm.showError('createdBy', formDir, 'required')"
              i18n>This field is required.</span>
      </ng-template>
    </div>
    <!-- Comment -->
    <div cdsCol
         class="form-item">
      <cds-textarea-label for="comment"
                          [invalid]="silenceForm.controls['comment'].invalid && (silenceForm.controls['comment'].dirty)"
                          [invalidText]="commentError"
                          cdRequiredField="Comment"
                          i18n>Comment
      <textarea cdsTextArea
                placeholder="comment..."
                i18n-placeholder
                id="comment"
                formControlName="comment"
                cols="200"
                rows="4"
                [invalid]="silenceForm.controls['comment'].invalid && (silenceForm.controls['comment'].dirty)"></textarea>
      </cds-textarea-label>
      <ng-template #commentError>
        <span *ngIf="silenceForm.showError('comment', formDir, 'required')"
              class="invalid-feedback"
              i18n>This field is required.</span>
      </ng-template>
    </div>
    <!-- Start time -->
    <div cdsCol>
      <cds-text-label >
        {{'Start time'}}
        <cd-helper class="text-pre-wrap"
                   i18n-helperText>
          <span>
          If the start time lies in the past the creation time will be used
          </span>
        </cd-helper>
        <cd-date-time-picker [control]="silenceForm.get('startsAt')"
                             placeHolder="Start time"
                             [hasTime]="false"
                             i18n-name>
        </cd-date-time-picker>
      </cds-text-label>
    </div>
    <!-- Duration -->
    <div class="form-item"
         cdsCol>
      <cds-text-label labelInputID="Duration"
                      i18n
                      i18n-helperText
                      cdRequiredField="Duration"
                      [invalid]="silenceForm.controls.duration.invalid && silenceForm.controls.duration.dirty"
                      [invalidText]="durationError">Duration
      <input cdsText
             type="text"
             id="duration"
             formControlName="duration"
             [invalid]="silenceForm.controls.duration.invalid && silenceForm.controls.duration.dirty"/>
      </cds-text-label>
      <ng-template #durationError>
        <span class="invalid-feedback"
              *ngIf="silenceForm.showError('duration', formDir, 'required')"
              i18n>This field is required.</span>
      </ng-template>
    </div>
    <!-- End time -->
    <div cdsCol>
      <cds-text-label >{{'End time'}}
        <cd-date-time-picker [control]="silenceForm.get('endsAt')"
                             placeHolder="End date"
                             [hasTime]="false"
                             i18n-name>
        </cd-date-time-picker>
      </cds-text-label>
    </div>
  </div>
  <fieldset>
    <legend class="required"
            i18n>Matchers</legend>
    <div class="form-item "
         cdsRow>
      <!-- Matchers -->
      <div cdsCol>
        <div class="text-center">
          <h5 *ngIf="matchers.length === 0"
              [ngClass]="{'text-warning': !formDir.submitted, 'text-danger': formDir.submitted}">
          <strong i18n>A silence requires at least one matcher</strong></h5>
          <span *ngFor="let matcher of matchers; let i=index;">
            <ng-container *ngTemplateOutlet="matcherTpl; context:{index: i, matcher: matcher}"></ng-container>
          </span>
        </div>
      </div>
    </div>
    <div cdsRow>
      <!-- Add Matcher Button -->
      <div cdsCol>
        <button cdsButton="tertiary"
                id="add-matcher"
                [ngClass]="{'btn-warning': formDir.submitted && matchers.length === 0 }"
                (click)="showMatcherModal()">
        <ng-container i18n>Add matcher</ng-container>
        <svg [cdsIcon]="icons.add"
             [size]="icons.size16"
             class="cds--btn__icon"></svg>
        </button>
      </div>
    </div>
  </fieldset>
  <!--Submit Button-->
  <cd-form-button-panel (submitActionEvent)="submit()"
                        [form]="silenceForm"
                        [submitText]="(action | titlecase) + ' ' + (resource | upperFirst)"
                        wrappingClass="text-right">
  </cd-form-button-panel>
  </form>
  </div>
