<cds-modal size="lg"
           [open]="open"
           [hasScrollingContent]="true"
           (overlaySelected)="closeModal()">
  <cds-modal-header (closeSelect)="closeModal()">
    <h3 cdsModalHeaderHeading
        i18n>Import multi-site tokens</h3>
  </cds-modal-header>

  <form name="importTokenForm"
        #frm="ngForm"
        [formGroup]="importTokenForm"
        novalidate>
    <div cdsModalContent
         class="rgw-import-modal__content">
      <div class="form-item">
        <cd-alert-panel type="info">
          <ul>
            <li i18n>This feature allows you to configure a connection between your primary and secondary Ceph clusters for data replication. By importing a token, you establish a link between the clusters, enabling data synchronization.</li>
            <li i18n>To obtain the token, generate it from your primary Ceph cluster. This token includes encoded information about the primary cluster's endpoint, access key, and secret key.</li>
            <li i18n>The secondary zone represents the destination cluster where your data will be replicated.</li>
          </ul>
        </cd-alert-panel>
      </div>
      <legend class="cd-header"
              i18n>Zone Details</legend>
      <div class="form-item">
        <cds-text-label
          labelInputID="realmToken"
          [invalid]="importTokenForm.showError('realmToken', frm)"
          [invalidText]="realmTokenError"
          cdRequiredField="Token"
          i18n
          >Token
          <input
            cdsText
            type="text"
            id="realmToken"
            name="realmToken"
            formControlName="realmToken"
            modal-primary-focus
            [invalid]="importTokenForm.showError('realmToken', frm)"
          />
        </cds-text-label>
        <ng-template #realmTokenError>
        @if (importTokenForm.showError('realmToken', frm, 'required')) {
          <span class="invalid-feedback"
                i18n>This field is required.</span>
        }
        </ng-template>
      </div>

      <div class="form-item">
        <cds-text-label
          labelInputID="zoneName"
          [invalid]="importTokenForm.showError('zoneName', frm)"
          [invalidText]="zoneNameError"
          cdRequiredField="Secondary Zone Name"
          i18n
          >Secondary Zone Name
          <input
            cdsText
            type="text"
            placeholder="Zone name..."
            id="zoneName"
            name="zoneName"
            formControlName="zoneName"
            [invalid]="importTokenForm.showError('zoneName', frm)"
          />
        </cds-text-label>
        <ng-template #zoneNameError>
        @if (importTokenForm.showError('zoneName', frm, 'required')) {
          <span class="invalid-feedback"
                i18n>This field is required.</span>
        }
        @if (importTokenForm.showError('zoneName', frm, 'uniqueName')) {
          <span class="invalid-feedback"
                i18n>The chosen zone name is already in use.</span>
        }
        </ng-template>
      </div>

      <legend class="cd-header"
              i18n>Service Details</legend>
      <div class="form-item">
        <cds-checkbox
          id="unmanaged"
          formControlName="unmanaged"
          >
          <span i18n>Unmanaged</span>
          <cd-help-text i18n>If set to true, the orchestrator will not start nor stop any daemon associated with this service.
            Placement and all other properties will be ignored.</cd-help-text>
        </cds-checkbox>
      </div>

      <!-- Placement -->
      @if (!importTokenForm.controls.unmanaged.value) {
        <div class="form-item"
             cdsRow>
          <div cdsCol>
            <cds-select
              formControlName="placement"
              label="Placement"
              i18n-label
              id="placement"
            >
              <option i18n
                      value="hosts">Hosts</option>
              <option i18n
                      value="label">Label</option>
            </cds-select>
          </div>
        </div>
      }

      <!-- Label -->
      @if (!importTokenForm.controls.unmanaged.value && importTokenForm.controls.placement.value === 'label') {
        <div class="form-item"
             cdsRow>
          <div cdsCol>
            <cds-combo-box
              label="Label"
              type="multi"
              formControlName="label"
              i18n-label
              [items]="labels"
              itemValueKey="content"
              id="label"
              [invalid]="importTokenForm.showError('label', frm)"
              [invalidText]="labelError"
              selectionFeedback="top-after-reopen"
              placeholder="Select labels..."
              i18n-placeholder
            >
              <cds-dropdown-list></cds-dropdown-list>
            </cds-combo-box>
            <ng-template #labelError>
            @if (importTokenForm.showError('label', frm, 'required')) {
              <span class="invalid-feedback"
                    i18n>This field is required.</span>
            }
            </ng-template>
          </div>
        </div>
      }

      <!-- Hosts -->
      @if (!importTokenForm.controls.unmanaged.value && importTokenForm.getValue('placement') === 'hosts') {
        <div class="form-item"
             cdsRow>
          <div cdsCol>
            <cds-combo-box
              label="Hosts"
              type="multi"
              formControlName="hosts"
              id="hosts"
              name="hosts"
              [items]="hosts"
              itemValueKey="content"
              [selectionFeedback]="'top-after-reopen'"
              placeholder="Select hosts..."
              i18n-placeholder
            >
              <cds-dropdown-list></cds-dropdown-list>
            </cds-combo-box>
          </div>
        </div>
      }

      <!-- count -->
      @if (!importTokenForm.controls.unmanaged.value) {
        <div class="form-item"
             cdsRow>
          <div cdsCol>
            <cds-number
              formControlName="count"
              label="Count"
              i18n-label
              [min]="1"
              [invalid]="importTokenForm.showError('count', frm)"
              [invalidText]="countError"
              [helperText]="countHelper"
            ></cds-number>
            <ng-template #countHelper>
              <span i18n>Only that number of daemons will be created.</span>
            </ng-template>
            <ng-template #countError>
            @if (importTokenForm.showError('count', frm, 'min')) {
              <span class="invalid-feedback"
                    i18n>The value must be at least 1.</span>
            }
            @if (importTokenForm.showError('count', frm, 'pattern')) {
              <span class="invalid-feedback"
                    i18n>The entered value needs to be a number.</span>
            }
            </ng-template>
          </div>
        </div>
      }

      <!-- RGW -->
      <ng-container *ngIf="!importTokenForm.controls.unmanaged.value">
        <!-- rgw_frontend_port -->
        <div class="form-item"
             cdsRow>
          <div cdsCol>
            <cds-number
              formControlName="rgw_frontend_port"
              label="Port"
              i18n-label
              [min]="1"
              [max]="65535"
              [invalid]="importTokenForm.showError('rgw_frontend_port', frm)"
              [invalidText]="portError"
            ></cds-number>
            <ng-template #portError>
            @if (importTokenForm.showError('rgw_frontend_port', frm, 'pattern')) {
              <span class="invalid-feedback"
                    i18n>The entered value needs to be a number.</span>
            }
            @if (importTokenForm.showError('rgw_frontend_port', frm, 'min')) {
              <span class="invalid-feedback"
                    i18n>The value must be at least 1.</span>
            }
            @if (importTokenForm.showError('rgw_frontend_port', frm, 'max')) {
              <span class="invalid-feedback"
                    i18n>The value cannot exceed 65535.</span>
            }
            </ng-template>
          </div>
        </div>
      </ng-container>
    </div>
    <cd-form-button-panel (submitActionEvent)="onSubmit()"
                          [submitText]="actionLabels.IMPORT"
                          [form]="importTokenForm"
                          [modalForm]="true"></cd-form-button-panel>
  </form>
</cds-modal>
