meta:
- desc: run the rbd_mirror_ha.sh workunit to test the rbd-mirror daemon
overrides:
  ceph:
    conf:
      client:
        rbd mirror image policy type: none
      # override to make these names predictable
      client.mirror.4:
        admin socket: /var/run/ceph/rbd-mirror.$cluster-$name.asok
        pid file: /var/run/ceph/rbd-mirror.$cluster-$name.pid
      client.mirror.5:
        admin socket: /var/run/ceph/rbd-mirror.$cluster-$name.asok
        pid file: /var/run/ceph/rbd-mirror.$cluster-$name.pid
      client.mirror.6:
        admin socket: /var/run/ceph/rbd-mirror.$cluster-$name.asok
        pid file: /var/run/ceph/rbd-mirror.$cluster-$name.pid
tasks:
- workunit:
    clients:
      cluster1.client.mirror: [rbd/rbd_mirror_ha.sh]
    env:
      # override workunit setting of CEPH_ARGS='--cluster'
      CEPH_ARGS: ''
      RBD_MIRROR_USE_EXISTING_CLUSTER: '1'
    timeout: 6h
