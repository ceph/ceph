# see http://tracker.ceph.com/issues/20360 and http://tracker.ceph.com/issues/18126
os_type: centos
os_version: '7.8'

overrides:
  install:
    ceph:
      flavor: notcmalloc
      debuginfo: true
  ceph:
    conf:
      global:
        osd heartbeat grace: 80
      mon:
        mon osd crush smoke test: false
      osd:
        osd fast shutdown: false
        debug bluestore: 1
        debug bluefs: 1
    log-whitelist:
      - overall HEALTH_
# valgrind is slow.. we might get PGs stuck peering etc
      - \(PG_
# mons sometimes are left off of initial quorum due to valgrind slowness.  ok to whitelist here because we'll still catch an actual crash due to the core
      - \(MON_DOWN\)
      - \(SLOW_OPS\)
      - slow request
    valgrind:
      mon: [--tool=memcheck, --leak-check=full, --show-reachable=yes]
      osd: [--tool=memcheck]
      mds: [--tool=memcheck]
# https://tracker.ceph.com/issues/38621
#      mgr: [--tool=memcheck]
